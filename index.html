<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas Coins | المحفظة</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --gold: #ffcc00; --bg: #050a18; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: white; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }

        /* الشاشات */
        #login-screen, #setup-screen, #main-dashboard { display: none; text-align: center; width: 100%; max-width: 400px; padding: 20px; }

        /* شاشة الدخول - توسيط كامل */
        #login-screen { flex-direction: column; justify-content: center; align-items: center; height: 100vh; }
        .main-coin { width: 180px; filter: drop-shadow(0 0 35px var(--gold)); animation: float 4s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* كارت البيانات الشخصية */
        .setup-card { background: rgba(255, 255, 255, 0.05); padding: 35px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .avatar-circle { width: 100px; height: 100px; border-radius: 50%; background: var(--gold); margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: var(--bg); font-weight: bold; cursor: pointer; border: 3px solid var(--gold); overflow: hidden; }
        .avatar-circle img { width: 100%; height: 100%; object-fit: cover; }

        input { background: rgba(255,255,255,0.08); border: 1px solid #333; color: white; padding: 12px; border-radius: 10px; margin-bottom: 15px; width: 100%; box-sizing: border-box; text-align: center; outline: none; }
        .dob-grid { display: flex; gap: 10px; }
        .btn-gold { width: 100%; background: var(--gold); color: var(--bg); border: none; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 1rem; }

        /* واجهة الرصيد والـ ID */
        .balance-card { background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.02)); padding: 25px; border-radius: 25px; border: 1px solid rgba(255,204,0,0.2); margin-top: 20px; }
        .balance-amount { font-size: 2.5rem; font-weight: bold; color: #fff; margin: 5px 0; }
        .user-id-tag { font-family: monospace; background: rgba(0,0,0,0.4); padding: 6px 15px; border-radius: 10px; color: var(--gold); font-size: 0.9rem; margin-top: 10px; display: inline-block; border: 1px solid rgba(255,204,0,0.1); }
    </style>
</head>
<body>

    <div id="login-screen">
        <img src="Atlas.png" class="main-coin" alt="Atlas Logo">
        <h1 style="color: var(--gold); margin-top: 20px; letter-spacing: 2px;">ATLAS COINS</h1>
        <div style="display: flex; justify-content: center; margin-top: 25px;">
            <div id="g_id_onload" data-client_id="YOUR_CLIENT_ID" data-callback="onSignIn"></div>
            <div class="g_id_signin" data-type="standard" data-theme="filled_blue" data-size="large"></div>
        </div>
    </div>

    <div id="setup-screen">
        <div class="setup-card">
            <div class="avatar-circle" id="user-avatar" onclick="document.getElementById('img-input').click()">A</div>
            <input type="file" id="img-input" hidden accept="image/*" onchange="preview(this)">
            <input type="text" id="full-name" placeholder="الاسم الكامل" oninput="updateLetter()">
            <div class="dob-grid">
                <input type="number" id="day" placeholder="يوم">
                <input type="number" id="month" placeholder="شهر">
                <input type="number" id="year" placeholder="سنة">
            </div>
            <button class="btn-gold" onclick="completeSetup()">استلام 1000 عملة و ID</button>
        </div>
    </div>

    <div id="main-dashboard">
        <div id="final-avatar-container"></div>
        <h2 id="hello-user" style="margin-top: 15px; margin-bottom: 5px;"></h2>
        <div id="display-id" class="user-id-tag">ID: 000-000-000</div>
        
        <div class="balance-card">
            <p style="margin: 0; color: #8892b0; font-size: 0.8rem;">رصيدك الحالي</p>
            <div class="balance-amount" id="user-balance">1,000</div>
            <div style="color: var(--gold); font-size: 0.8rem; letter-spacing: 1px;">ATLAS COIN (AC)</div>
        </div>

        <button onclick="logout()" style="background:none; border:1px solid #ff4444; color:#ff4444; padding:10px 20px; border-radius:12px; cursor:pointer; margin-top:40px; font-weight:bold;">تسجيل الخروج</button>
    </div>

    <script>
        let uploadedImg = "";

        // توليد ID عشوائي 9 أرقام
        function generateUniqueID() {
            let id = Math.floor(100000000 + Math.random() * 900000000).toString();
            return id.replace(/(\d{3})(\d{3})(\d{3})/, "$1-$2-$3");
        }

        window.onload = function() {
            const savedData = localStorage.getItem('atlas_session');
            if (savedData) {
                renderDashboard(JSON.parse(savedData));
            } else {
                document.getElementById('login-screen').style.display = 'flex';
            }
        };

        function onSignIn() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('setup-screen').style.display = 'block';
        }

        function updateLetter() {
            const name = document.getElementById('full-name').value;
            const circle = document.getElementById('user-avatar');
            if (!circle.querySelector('img')) circle.innerText = name ? name[0].toUpperCase() : "A";
        }

        function preview(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    uploadedImg = e.target.result;
                    document.getElementById('user-avatar').innerHTML = `<img src="${uploadedImg}">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function completeSetup() {
            const nameVal = document.getElementById('full-name').value || "مستخدم أطلس";
            const user = {
                name: nameVal,
                photo: uploadedImg,
                balance: 1000,
                id: generateUniqueID(),
                status: 'logged_in'
            };
            localStorage.setItem('atlas_session', JSON.stringify(user));
            renderDashboard(user);
        }

        function renderDashboard(user) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('main-dashboard').style.display = 'block';
            
            document.getElementById('hello-user').innerText = "أهلاً، " + user.name;
            document.getElementById('display-id').innerText = "ID: " + user.id;
            document.getElementById('user-balance').innerText = user.balance.toLocaleString();
            
            const container = document.getElementById('final-avatar-container');
            const avatarHtml = user.photo 
                ? `<img src="${user.photo}" style="width:90px; height:90px; border-radius:50%; border:2px solid var(--gold); object-fit:cover;">`
                : `<div style="width:90px; height:90px; border-radius:50%; background:var(--gold); color:var(--bg); display:flex; align-items:center; justify-content:center; font-size:2rem; margin:0 auto; font-weight:bold; border:2px solid var(--gold);">${user.name[0].toUpperCase()}</div>`;
            container.innerHTML = avatarHtml;
        }

        function logout() {
            localStorage.removeItem('atlas_session');
            location.reload();
        }
    </script>
</body>
</html>
