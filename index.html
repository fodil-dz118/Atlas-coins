<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas Coins</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --gold: #ffcc00; --bg: #050a18; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: white; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }

        /* شاشات التطبيق */
        #login-screen, #setup-screen, #main-dashboard { display: none; text-align: center; width: 100%; max-width: 400px; padding: 20px; }

        /* توسيط محتوى الدخول */
        #login-screen { flex-direction: column; justify-content: center; align-items: center; height: 100vh; }
        .google-btn-center { display: flex; justify-content: center; width: 100%; margin-top: 25px; }

        /* الشعار المتحرك */
        .main-coin { width: 190px; filter: drop-shadow(0 0 35px var(--gold)); animation: float 4s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        /* كارت إكمال البيانات */
        .setup-card { background: rgba(255, 255, 255, 0.05); padding: 35px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .avatar-circle { width: 110px; height: 110px; border-radius: 50%; background: var(--gold); margin: 0 auto 25px; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: var(--bg); font-weight: bold; cursor: pointer; border: 3px solid var(--gold); overflow: hidden; }
        .avatar-circle img { width: 100%; height: 100%; object-fit: cover; }

        input { background: rgba(255,255,255,0.08); border: 1px solid #333; color: white; padding: 14px; border-radius: 12px; margin-bottom: 15px; width: 100%; box-sizing: border-box; text-align: center; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--gold); }
        .dob-grid { display: flex; gap: 10px; }
        .btn-gold { width: 100%; background: var(--gold); color: var(--bg); border: none; padding: 16px; border-radius: 15px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
    </style>
</head>
<body>

    <div id="login-screen">
        <img src="Atlas.png" class="main-coin" alt="Atlas">
        <h1 style="color: var(--gold); letter-spacing: 2px; margin-top: 25px; margin-bottom: 5px;">ATLAS COINS</h1>
        <p style="color: #8892b0;">مرحباً بك، سجل دخولك للبدء</p>
        
        <div class="google-btn-center">
            <div id="g_id_onload" 
                 data-client_id="622781570163-qh2h251eouj3orakpoj15tgma9njo3a9.apps.googleusercontent.com" 
                 data-callback="onSignIn">
            </div>
            <div class="g_id_signin" data-type="standard" data-theme="filled_blue" data-size="large"></div>
        </div>
    </div>

    <div id="setup-screen">
        <div class="setup-card">
            <div class="avatar-circle" id="user-avatar" onclick="document.getElementById('img-input').click()">A</div>
            <input type="file" id="img-input" hidden accept="image/*" onchange="preview(this)">
            
            <input type="text" id="full-name" placeholder="الاسم الكامل" oninput="updateLetter()">
            
            <div class="dob-grid">
                <input type="number" id="day" placeholder="يوم" min="1" max="31">
                <input type="number" id="month" placeholder="شهر" min="1" max="12">
                <input type="number" id="year" placeholder="سنة">
            </div>
            
            <button class="btn-gold" onclick="completeSetup()">تأكيد المعلومات</button>
        </div>
    </div>

    <div id="main-dashboard">
        <div id="final-avatar-container"></div>
        <h2 id="hello-user" style="color: var(--gold); margin-top: 15px;"></h2>
        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 20px; margin-top: 20px;">
            <p style="margin: 0; color: #8892b0;">رصيدك المتوفر</p>
            <h1 style="margin: 10px 0;">0.00 <span style="font-size: 1rem; color: var(--gold);">AC</span></h1>
        </div>
        <button onclick="logout()" style="background:none; border:1px solid #ff4444; color:#ff4444; padding:10px 25px; border-radius:12px; cursor:pointer; margin-top:30px; font-weight:bold;">تسجيل الخروج</button>
    </div>

    <script>
        let uploadedImg = "";

        // فحص الجلسة عند التحميل
        window.onload = function() {
            const data = localStorage.getItem('atlas_session');
            if (data) {
                renderDashboard(JSON.parse(data));
            } else {
                document.getElementById('login-screen').style.display = 'flex';
            }
        };

        function onSignIn() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('setup-screen').style.display = 'block';
        }

        function updateLetter() {
            const name = document.getElementById('full-name').value;
            const circle = document.getElementById('user-avatar');
            if (!circle.querySelector('img')) circle.innerText = name ? name[0].toUpperCase() : "A";
        }

        function preview(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    uploadedImg = e.target.result;
                    document.getElementById('user-avatar').innerHTML = `<img src="${uploadedImg}">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function completeSetup() {
            const nameVal = document.getElementById('full-name').value || "مستخدم أطلس";
            const user = {
                name: nameVal,
                photo: uploadedImg,
                status: 'logged_in'
            };
            localStorage.setItem('atlas_session', JSON.stringify(user));
            renderDashboard(user);
        }

        function renderDashboard(user) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('main-dashboard').style.display = 'block';
            document.getElementById('hello-user').innerText = "أهلاً، " + user.name;
            
            const container = document.getElementById('final-avatar-container');
            if(user.photo) {
                container.innerHTML = `<img src="${user.photo}" style="width:110px; height:110px; border-radius:50%; border:3px solid var(--gold); object-fit:cover;">`;
            } else {
                container.innerHTML = `<div style="width:110px; height:110px; border-radius:50%; background:var(--gold); color:var(--bg); display:flex; align-items:center; justify-content:center; font-size:3rem; margin:0 auto; font-weight:bold; border:3px solid var(--gold);">${user.name[0].toUpperCase()}</div>`;
            }
        }

        function logout() {
            localStorage.removeItem('atlas_session');
            location.reload();
        }
    </script>
</body>
</html>
